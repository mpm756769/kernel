MYD-C437X-PRU

Introduction
==============
To be able to use MYD-C437X-PRU board of MYIR with the images generated by
Buildroot, you have to prepare the SDCard.

How to build it
===============

  $ make myd_c437x_idk_defconfig

Then you can edit the build options using

  $ make menuconfig

Compile all and build rootfs image:

  $ make

Result of the build
-------------------

After building, you should get a tree like this:

  output/images/
  ├── MLO
  ├── u-boot.img
  ├── u-boot-spl.bin
  ├── uEnv.txt
  ├── uEnv_mmc.txt
  ├── uEnv_ramdisk.txt
  ├── myd_c437x_idk.dtb
  ├── myd_c437x_idk_lcd.dtb
  ├── zImage
  ├── rootfs.cpio
  ├── rootfs.cpio.gz
  ├── rootfs.cpio.uboot
  ├── rootfs.ext2
  ├── rootfs.ext4
  ├── rootfs.tar
  ├── rootfs.tar.gz
  ├── rootfs.ubi
  ├── rootfs.ubifs
  ├── sdcard.img
  └── zImage

How to use it
===============
1. Boot from TF/SD card with ramdisk
  - Format TF/SD with fat/fat32 format
  - Copy MLO, u-boot.img, uEnv_ramdisk.txt, zImage, myd_c437x_idk.dtb, myd_c437x_idk_lcd.dtb, ramdisk.gz to TF/SD card.
  - Rename uEnv_ramdisk.txt to uEnv.txt
  - Insert the TF/SD card to slot J19, and set bootmode to mmc0
  - Powreoff and poweron to boot from TF/SD card with ramdisk
   
2. Boot from TF/SD card with EXT4 partition on TF/SD card
  - Program sdcard.img to TF/SD card with Win32DiskImager.exe on windows pc.
  - Powreoff and poweron to boot from TF/SD card with ext4 partition on TF/SD card.

3. Boot from Ethernet with NFS
  - Enter U-boot console by press 'space' when u-boot booting from TF/SD card.
  - setenv serverip 192.168.1.2 ( nfs server and tftp server hosted on 192.168.1.2)
  - setenv ipaddr 192.168.1.100 ( set the ipaddr of myd_c437x_pru board)
  - setenv rootpath /home/sunny/export/rootfs ( exported nfs directory with /etc/exports file on nfs server)
  - run netboot

4. Boot from Ethernet with ramdisk
  - Enter U-boot console by press 'space' when u-boot booting from TF/SD card.
  - setenv serverip 192.168.1.2 ( nfs server and tftp server hosted on 192.168.1.2)
  - setenv ipaddr 192.168.1.100 ( set the ipaddr of myd_c437x_pru board)
  - setenv bootargs console=ttyO0,115200n8 root=/dev/ram0 rw rootfstype=ext2 ip=none earlyprintk
  - tftpboot ${loadaddr} zImage  ( zImage was copied to tftp server root directory)
  - tftpboot ${rdaddr} ramdisk.gz ( ramdisk.gz was copied to tftp server root directory)
  - tftpboot ${fdtaddr} myd_c437x_idk.dtb  ( myd_c437x_idk.dtb was copied to tftp server root directory)
  - bootz  ${loadaddr} ${rdaddr} ${fdtaddr}

5. Boot from EMMC 
  - Copy sdcard.img to TF/SD card.
  - Boot from TF/SD card with ramdisk.
  - Enter linux console and execute the command to write sdcard.img to emmc. 
    # mount /dev/mmcblk0p1 /media
    # dd bs=1M if=/media/sdcard.img of=/dev/mmcblk1
  - Set bootmode to emmc and reboot

Links
===============
1. https://sourceforge.net/projects/win32diskimager/
2. https://buildroot.org/
